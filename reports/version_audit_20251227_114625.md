# Quant_System 版本审计报告
- 时间: 2025-12-27 11:46:25
- 根目录: `C:\Users\Administrator\Desktop\Quant_System`
- 开发计划文件: 已检测到
- 判定完成到: **M8**
- 版本归类: **V1.1+（工程化/除权除息/看板等）**

## 里程碑总览（M0~M8）
| Milestone | Done | HitRatio | Passed/Total | Title |
|---|---:|---:|---:|---|
| M0 | ✅ | 1.00 | 5/5 | snapshot→factors→preprocess→rule_score→picks 基础闭环 |
| M1 | ✅ | 1.00 | 4/4 | labels (D+1 open → D+h close) + 一字板 buyable=0 |
| M2 | ✅ | 1.00 | 4/4 | portfolio（Buffer/成本/锁仓/T+1结算） |
| M3 | ✅ | 1.00 | 5/5 | monitor + factpack + execution_log + SQLite/WAL + 浮点isclose |
| M4 | ✅ | 1.00 | 6/6 | Night/Morning 两段作业 + orders 协议 + 对账闭环 + trade_cal |
| M5 | ✅ | 1.00 | 4/4 | STOP + Fat-Finger + AssetCheck + smoke test |
| M6 | ✅ | 1.00 | 4/4 | 双头模型 shadow（batch+context+熔断降级） |
| M7 | ✅ | 1.00 | 3/3 | 开闸 rerank + risk gate |
| M8 | ✅ | 1.00 | 5/5 | 除权除息 + Parquet + Patch/Registry/Migrator + Dashboard + Regime |

## 硬边界检查（实盘可信度关键）
| Guard | OK | 说明 |
|---|---:|---|
| `append_only_snapshot` | ✅ | snapshot_raw append-only（尽量只有 INSERT，不做 UPDATE/DELETE 覆盖历史） |
| `no_future_leak` | ✅ | 避免未来数据泄漏（D+1 open/up_limit/low_limit 不进入 D 日特征） |
| `trade_calendar_gate` | ✅ | pipeline 首步 is_trade_day / trade_cal gate（非交易日退出） |
| `float_isclose` | ✅ | 金额/收益/对账使用 isclose/round/Decimal，避免直接 == |
| `sqlite_wal` | ✅ | SQLite WAL 或同等并发/可靠性设置 |
| `atomic_write_orders` | ✅ | orders 输出原子写（tmp + replace）防止半写文件 |

## 缺口清单（优先级建议：先补硬边界，再补 M4/M5）
- ✅ 硬边界全部通过

- ✅ 里程碑检查项全部命中（仅代表“存在实现迹象”，仍建议跑回测验收）

## 关键证据（命中示例）

### M0 - snapshot→factors→preprocess→rule_score→picks 基础闭环
- ✅ snapshot 存在
  - file: `C:\Users\Administrator\Desktop\Quant_System\开发计划.txt`
  - snippet: `实成交、真实持仓与资产  两端通过文件协议 + 每日对账闭环，达到：可复盘、可执行、可长期稳定跑  0.2 三条铁律  Snapshot Immutable（append-only）：snapshot_raw 只追加不覆盖  禁止未来数据泄漏：D+1 的 `

### M3 - monitor + factpack + execution_log + SQLite/WAL + 浮点isclose
- ✅ monitor/监控
  - file: `C:\Users\Administrator\Desktop\Quant_System\README.md`
  - snippet: `tem V1.5（Windows UI + PTrade 文件桥）  本包目标：**本地 Python 负责决策/风控/监控/出单文件**，PTrade 负责**真实下单/真实成交/真实持仓**，两端通过 `bridge/` 目录文件握手完成闭`

### M4 - Night/Morning 两段作业 + orders 协议 + 对账闭环 + trade_cal
- ✅ Night_Job
  - file: `C:\Users\Administrator\Desktop\Quant_System\main.py`
  - snippet: `son import sys from datetime import datetime  from src.jobs.night_job import run_night_job from src.jobs.morning_job import run_m`

### M5 - STOP + Fat-Finger + AssetCheck + smoke test
- ✅ STOP/熔断
  - file: `C:\Users\Administrator\Desktop\Quant_System\README.md`
  - snippet: `py`：**SchemaMigrator（补齐缺列）** - `bridge/`：文件桥（outbox/inbox + STOP Kill Switch） - `ptrade/`：PTrade Receiver + 你原来的策略脚本副本  --- `

### M6 - 双头模型 shadow（batch+context+熔断降级）
- ✅ dual head
  - file: `C:\Users\Administrator\Desktop\Quant_System\README.md`
  - snippet: `架实现**：不会依赖外部指数数据，后续你接入 IndexSnapshot 后可升级成真实 MA20 / 熔断逻辑）。  双头模型： - `model.enabled` 默认 `false`（Shadow 模式） - UI 会仍然展示“辩论庭”卡`

### M8 - 除权除息 + Parquet + Patch/Registry/Migrator + Dashboard + Regime
- ✅ 除权除息
  - file: `C:\Users\Administrator\Desktop\Quant_System\开发计划.txt`
  - snippet: `lose/round），避免对账误报  V1.1 / V1.2（增强）  CorporateActionHandler（除权除息/送转/分红）  UniversePolicy（300/688 exclude/penalty/shadow）  S`
