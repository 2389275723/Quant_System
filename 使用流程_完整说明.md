# Quant_System v1.5.3 å®Œæ•´ä½¿ç”¨æµç¨‹ï¼ˆWindows UI + PTrade æ–‡ä»¶æ¡¥ + ç¬¬ä¸‰æ–¹ TuShare + DeepSeek/Qwenï¼‰

> ç›®æ ‡ï¼š  
> 1) æ¥å…¥ **ç¬¬ä¸‰æ–¹ TuShare ç½‘å…³**ï¼ˆtoken + http_urlï¼‰å¹¶è‡ªåŠ¨ç”Ÿæˆ/æ›´æ–° `daily_bars.csv`  
> 2) æ‰“é€š **PTrade å¿ƒè·³**ï¼ˆå·¦ä¾§å˜ç»¿ï¼‰+ **orders_processed å›æ‰§**ï¼ˆé—­ç¯ï¼‰  
> 3) æ¥å…¥ **DualHeadModelEngine** çœŸå®è°ƒç”¨ **DeepSeek + Qwen(OpenAI Compatible)**ï¼Œè®©ã€ŒAI è¾©è®ºåº­ã€æœ‰çœŸå®æ–‡æœ¬

---

## 0. ç›®å½•ä¸å…³é”®æ–‡ä»¶ï¼ˆå…ˆå¯¹é½ï¼‰

é¡¹ç›®æ ¹ç›®å½•ï¼š`Quant_System/`

å…³é”®è·¯å¾„ï¼š

- `config/config.yaml`ï¼šç³»ç»Ÿé…ç½®ï¼ˆTopNã€æ¨¡å‹å¼€å…³ã€é£æ§é˜ˆå€¼ç­‰ï¼‰
- `data/bars/daily_bars.csv`ï¼šé€‰è‚¡è¾“å…¥æ•°æ®ï¼ˆNight Job è¯»å–ï¼‰
- `data/quant.db`ï¼šSQLite æ•°æ®åº“ï¼ˆpicksã€model_scoresã€execution_logï¼‰
- `bridge/outbox/orders.csv`ï¼šMorning Job ç”Ÿæˆçš„è®¢å•æ–‡ä»¶ï¼ˆPTrade ç«¯è¯»å–ï¼‰
- `bridge/outbox/orders_processed_*.csv`ï¼šPTrade å¤„ç†åçš„å›æ‰§ï¼ˆUI ç«¯è¯†åˆ«å®Œæˆï¼‰
- `bridge/inbox/ptrade_heartbeat.json`ï¼šPTrade å¿ƒè·³ï¼ˆUI ç«¯ç”¨æ¥ç‚¹äº®â€œäº¤æ˜“ç«¯â€ï¼‰
- `bridge/STOP`ï¼šç´§æ€¥ç†”æ–­ï¼ˆKILLï¼‰

---

## 1. ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼ˆWindowsï¼‰

### 1.1 å®‰è£…ä¾èµ–å¹¶å¯åŠ¨ UI
åœ¨é¡¹ç›®æ ¹ç›®å½•åŒå‡»ï¼š

- `run_ui.bat`

> å»ºè®®æ°¸è¿œç”¨ `run_ui.bat` å¯åŠ¨ UIï¼Œé¿å…â€œå·¥ä½œç›®å½•ä¸åŒå¯¼è‡´ç”Ÿæˆå¦ä¸€ä»½ quant.dbâ€çš„é—®é¢˜ã€‚

---

## 2. é…ç½®ç¬¬ä¸‰æ–¹ TuShareï¼ˆé‡ç‚¹ï¼‰

ä½ ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ TuShare ç½‘å…³ç”¨æ³•ç±»ä¼¼ï¼š

```python
import tushare as ts
pro = ts.pro_api('éšä¾¿å¡«')
pro._DataApi__token = 'ä½ çš„token'
pro._DataApi__http_url = 'http://ä½ çš„ç½‘å…³/dataapi'
```

æœ¬ç‰ˆæœ¬å·²å†…ç½®åŒæ ·é€»è¾‘ï¼šè¯»å– `.env` çš„ `TUSHARE_TOKEN` + `TUSHARE_HTTP_URL`ï¼Œå¹¶å¼ºåˆ¶å†™å…¥åˆ° `pro` å¯¹è±¡ã€‚

### 2.1 åœ¨ UI é‡Œå¡«å†™å¹¶ä¿å­˜ï¼ˆæ¨èï¼‰
æ‰“å¼€ UI â†’ **ç³»ç»Ÿè®¾ç½®**ï¼š

- `Tushare Token`ï¼šå¡«ä½ çš„ token  
- `Tushare HTTP URLï¼ˆç¬¬ä¸‰æ–¹ç½‘å…³ï¼Œå¯é€‰ï¼‰`ï¼šå¡«ä½ çš„ç¬¬ä¸‰æ–¹ URLï¼ˆå¦‚ `http://7d01.xiximiao.com/dataapi`ï¼‰

ç‚¹ **ğŸ’¾ ä¿å­˜è®¾ç½®**ï¼Œç„¶å **é‡å¯ UI**ï¼ˆå»ºè®®é‡å¯ä¸€æ¬¡è®©ç¯å¢ƒå˜é‡åŠ è½½æ›´å¹²å‡€ï¼‰ã€‚

### 2.2 å‘½ä»¤è¡ŒéªŒè¯ï¼ˆå¯é€‰ï¼‰
```bat
cd /d C:\Users\Administrator\Desktop\Quant_System
.\.venv\Scripts\python.exe -c "from src.data.tushare_bars import health_check; print(health_check('20251224'))"
```

---

## 3. ç”Ÿæˆ/æ›´æ–° barsï¼ˆdaily_bars.csvï¼‰

æœ‰ä¸¤ç§æ–¹å¼ï¼š

### 3.1 ç”¨ bat ä¸€é”®æ›´æ–°
åŒå‡»ï¼š
- `run_update_bars.bat`

æˆåŠŸåä¼šæ›´æ–°ï¼š
- `data/bars/daily_bars.csv`

### 3.2 åœ¨ UI é‡Œæ›´æ–°ï¼ˆå¦‚æœä½ å¼€å¯äº†æŒ‰é’®/åç»­æˆ‘å¯å†å¸®ä½ åŠ æ›´å®Œæ•´çš„ UIï¼‰
ç›®å‰æ¨èä½¿ç”¨ `run_update_bars.bat`ï¼Œæœ€ç¨³ã€‚

---

## 4. æ¯å¤©æ”¶ç›˜åï¼šNight Jobï¼ˆé€‰è‚¡ + AI è¾©è®ºè¾“å…¥è½åº“ï¼‰

åœ¨ UI é¦–é¡µç‚¹ï¼š

- ğŸŒ™ **è¿è¡Œ Night Job**

å®ƒä¼šï¼š
- è¯»å– `daily_bars.csv`
- è¿‡æ»¤ Universeï¼ˆé»˜è®¤å‰”é™¤ 300/688/301/689ï¼‰
- æ‰“åˆ†å¹¶å†™å…¥ `picks_daily`
- å¦‚æœ `model.enabled=true` ä¸” Key æ­£ç¡®ï¼Œä¼šå†™å…¥ `model_scores_daily`

---

## 5. æ¬¡æ—¥ç›˜å‰ï¼šMorning Jobï¼ˆç”Ÿæˆ orders.csvï¼‰

åœ¨ UI é¦–é¡µç‚¹ï¼š

- â˜€ï¸ **è¿è¡Œ Morning Job (09:26)**

å®ƒä¼šç”Ÿæˆï¼š
- `bridge/outbox/orders.csv`

---

## 6. æ‰“é€š PTradeï¼ˆè®©å·¦ä¾§äº¤æ˜“ç«¯å˜ç»¿ + å›æ‰§ç”Ÿæˆï¼‰

### 6.1 æ ¸å¿ƒåŸåˆ™ï¼š**Windows UI ä¸ PTrade å¿…é¡»æŒ‡å‘åŒä¸€ä¸ª bridge ç›®å½•**
æ¨èåšæ³•ï¼šåœ¨ PTrade research ç«¯è®¾ç½®ç¯å¢ƒå˜é‡æˆ–è„šæœ¬å¼ºåˆ¶æŒ‡å®šï¼š

```python
import os
os.environ["QUANT_BRIDGE_DIR"] = r"C:\Users\Administrator\Desktop\Quant_System\bridge"
```

ç„¶åè¿è¡Œï¼š
- `ptrade/PTrade_Dumb_Executor.py`

### 6.2 å¿ƒè·³å˜ç»¿æ€ä¹ˆéªŒè¯ï¼Ÿ
çœ‹è¿™ä¸ªæ–‡ä»¶æ˜¯å¦æŒç»­æ›´æ–°ï¼š
- `bridge/inbox/ptrade_heartbeat.json`

æœ¬ç‰ˆæœ¬å·²åœ¨ `initialize()` å°±å†™ä¸€æ¬¡å¿ƒè·³ï¼ˆå¯åŠ¨å UI èƒ½ç«‹åˆ»å˜ç»¿ï¼‰ï¼Œç›˜ä¸­ `handle_data()` ä¼šæŒç»­åˆ·æ–°ã€‚

### 6.3 orders_processed å›æ‰§æ€ä¹ˆéªŒè¯ï¼Ÿ
å½“ UI ç”Ÿæˆ `orders.csv` åï¼š

- PTrade è„šæœ¬ä¼šè¯»å– â†’ æ‰§è¡Œï¼ˆç›®å‰æ˜¯æ‰“å°å ä½ï¼‰â†’ æŠŠ `orders.csv` rename æˆï¼š
  - `orders_processed_YYYYMMDD_RUNID.csv`

çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶å‡ºç°ï¼Œå°±è¯´æ˜é—­ç¯é€šäº†ã€‚

---

## 7. å¼€å¯çœŸå® AI è¾©è®ºï¼ˆDeepSeek + Qwenï¼‰

### 7.1 å†™å…¥ Keyï¼ˆUI ç³»ç»Ÿè®¾ç½®ï¼‰
- DeepSeek Key â†’ å†™å…¥ `DEEPSEEK_API_KEY`
- DashScope Key â†’ å†™å…¥ `DASHSCOPE_API_KEY`

å¯é€‰ï¼š
- `DEEPSEEK_BASE_URL`ï¼ˆé»˜è®¤ `https://api.deepseek.com`ï¼‰
- `DASHSCOPE_BASE_URL`ï¼ˆé»˜è®¤ `https://dashscope.aliyuncs.com/compatible-mode/v1`ï¼‰

### 7.2 å¼€å¯æ¨¡å‹å¼€å…³
åœ¨ `config/config.yaml`ï¼š

```yaml
model:
  enabled: true
  qwen:
    model: qwen3-max
```

ä¿å­˜å **é‡å¯ UI**ï¼Œå¹¶é‡æ–°è·‘ä¸€æ¬¡ Night Jobã€‚

### 7.3 æˆæœ¬ä¸é€Ÿåº¦å»ºè®®
- `model.max_items`ï¼šé»˜è®¤ 20ï¼ˆåªå¯¹ Top20 è°ƒç”¨ï¼Œé¿å…æ‰£è´¹å¤ªçŒ›ï¼‰
- å»ºè®®å…ˆç”¨ TopN/Top20 éªŒè¯ï¼Œå†é€æ­¥åŠ ã€‚

---

## 8. å¸¸è§é—®é¢˜

### 8.1 â€œAI è¾©è®ºåº­æ²¡æ•°æ® / shadow disabledâ€
- `model.enabled` è¿˜æ˜¯ `false`
- æˆ– Key æ²¡å¡«/æ²¡é‡å¯ UI
- æˆ– Night Job è¿˜æ²¡é‡æ–°è·‘

### 8.2 â€œPTrade å¿ƒè·³ç¼ºå¤±â€
- PTrade æ²¡è·‘è„šæœ¬
- QUANT_BRIDGE_DIR æŒ‡é”™ç›®å½•ï¼ˆä¸æ˜¯åŒä¸€ä»½ bridgeï¼‰
- ä½ éäº¤æ˜“æ—¶æ®µã€`handle_data` ä¸è§¦å‘ï¼ˆä½†æœ¬ç‰ˆ initialize ä¼šå†™ä¸€æ¬¡å¿ƒè·³ï¼‰

### 8.3 â€œorders_processed ä¸ç”Ÿæˆâ€
- PTrade æ²¡çœ‹åˆ° `orders.csv`
- bridge/outbox æƒé™é—®é¢˜
- STOP æ–‡ä»¶å­˜åœ¨ï¼ˆ`bridge/STOP`ï¼‰

---

## 9. ä½ æ¯å¤©çš„æœ€çŸ­æ“ä½œæ¸…å•ï¼ˆSOPï¼‰

1) é…ä¸€æ¬¡ `.env`ï¼ˆtokenã€http_urlã€keysï¼‰  
2) æ¯å¤©æ”¶ç›˜åï¼šUI ç‚¹ **Night Job**  
3) æ¬¡æ—¥ç›˜å‰ï¼šUI ç‚¹ **Morning Job**ï¼ˆç”Ÿæˆ orders.csvï¼‰  
4) PTrade research è¿è¡Œ `PTrade_Dumb_Executor.py`ï¼ˆå¿ƒè·³ç»¿ + processed å›æ‰§ï¼‰
